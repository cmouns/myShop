{% extends 'base.html.twig' %}

{% block title %}Produits{% endblock %}

{% block body %}
<div class="container">
  <h1 class="mb-5 mt-5">Produits</h1>
  {% include 'layouts/_flash_message.html.twig'%}
  <div class="row">
    {% for product in productsWithSlugs %}
      {% if product.sub_category_slug %}
        <div class="col-md-3 mb-4 d-flex">
          <div class="card h-100 w-100 d-flex flex-column">
            <div class="card-img-top ratio ratio-4x3 bg-light rounded-top" style="overflow: hidden;">
              <img 
                src="{{ asset('uploads/images/' ~ product.image) }}" 
                alt="{{ product.name }}" 
                class="img-fluid h-100 w-100"
                style="object-fit: contain; background: #f8f9fa;">
            </div>
            <div class="card-body d-flex flex-column">
              <a href="{{ path('app_home_product_show', {
                'sub_category_slug': product.sub_category_slug,
                'id': product.id,
                'slug': product.slug
              }) }}">
                <h5 class="card-title titleProduct" style="min-height:2.4em">{{ product.name }}</h5>
              </a>
              <h3>{{ product.price }}€</h3>
              <a href="{{ path('app_cart_new',{'id':product.id}) }}" class="btn btn-outline-success mt-auto w-150">Ajouter au panier</a>
            </div>
          </div>
        </div>
      {% endif %}
    {% endfor %}
    {{ knp_pagination_render(products, 'layouts/_paginator.html.twig') }}
  </div>

  {# Liens vers les sous-catégories #}
  {% for category in categories %}
    {% for subCategory in category.getSubCategories() %}
      {% if category.getSlug() and subCategory.getSlug() %}
        <a href="{{ path('app_home_product_filter', {
          'category_slug': category.getSlug(),
          'sub_category_slug': subCategory.getSlug()
        }) }}">
          {{ subCategory.getName() }}
        </a>
      {% endif %}
    {% endfor %}
  {% endfor %}
</div>
{% endblock %}
